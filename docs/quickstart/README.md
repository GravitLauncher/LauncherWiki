# Быстрый старт

В этой инструкции мы подробно разберем техническую сторону создания своего проекта. Всё остальное - от идеи и тематики до команды администраторов, разработчиков и дизайнеров это полностью ваш выбор. Этот гайд будет полезен как новичкам, так и опытным администраторам - каждый найдет для себя здесь что то новое.

## Выбор хостинга

Мы рекомендуем иметь несколько VDS/VPS серверов под различные задачи если это возможно. Так обеспечивается большая безопасность и разделение ответственности - проблемы на одном сервере не приведут к проблемам на другом сервере. Мы рекомендуем иметь хотя бы два сервера - VDS/VPS под лаунчсервер, сайт и базу данных, и VDS/Dedicated сервер под сервера.

### Требования к хостингу для GravitLauncher, сайта и базы данных

Общие требования, учитывающие что вы будете держать на этом сервере GravitLauncher, сайт и базу данных

:::: tabs

@tab Минимальные
- 2Гб оперативной памяти
- 1 или 2 ядра
- 10Гб свободного пространства HDD или SSD
- Виртуализация KVM или Hyper-V
- Актуальный дистрибутив Linux: Ubuntu 24.10 и выше, Debian 12 и выше, ArchLinux, Fedora
- IPv4 адрес

@tab Рекомендуемые
- 4Гб оперативной памяти
- 2 или 4 ядра
- 30Гб свободного пространства SSD
- Виртуализация KVM или Hyper-V
- Актуальный дистрибутив Linux: Ubuntu 24.10 и выше, Debian 12 и выше, ArchLinux, Fedora
- IPv4 адрес
::::

### Требования к хостингу Minecraft сервера

Требования зависят от версии Minecraft, числа игроков, установленных модов и плагинов и размера карты. Поскольку в отличии от сайта, базы данных и GravitLauncher сервер Minecraft не способен использовать много потоков, главными притериями выбора становится частота процессора и объем оперативной памяти. Здесь вы можете посмотреть усредненные цифры для сборок средней сложности и небольшом онлайне. Если вы планируете держать несколько серверов на одном физическом/виртуальном сервере убедитесь что ресурсов процессора, памяти и диска хватит всем.

:::: tabs
@tab Легкая сборка
- 4Гб оперативной памяти
- 2 ядра
- 30Гб свободного пространства SSD
- Виртуализация KVM или Hyper-V
- Актуальный дистрибутив Linux: Ubuntu 24.10 и выше, Debian 12 и выше, ArchLinux, Fedora
- IPv4 адрес

@tab Средняя сборка
- 8Гб оперативной памяти
- 4 ядра
- 50Гб свободного пространства SSD
- Виртуализация KVM или Hyper-V
- Актуальный дистрибутив Linux: Ubuntu 24.10 и выше, Debian 12 и выше, ArchLinux, Fedora
- IPv4 адрес

@tab Тяжелая сборка
- 16Гб оперативной памяти
- 6 ядер
- 80Гб свободного пространства SSD
- Виртуализация KVM или Hyper-V
- Актуальный дистрибутив Linux: Ubuntu 24.10 и выше, Debian 12 и выше, ArchLinux, Fedora
- IPv4 адрес
::::


### VDS против Dedicated

Производительность dedicated серверов выше, так как вы не делите ресурсы с другими пользователями хостинга - весь физический сервер принадлежит вам. Однако аренда dedicated сервера вам обойдется дороже, а его мощности оправданы только при наличии нескольких Minecraft серверов или большом онлайне. С точки зрения настройки VDS и dedicated не будут отличаться.

### Выбор хостинг провайдера

В мире существуют множество компаний предлагающих услуги хостинга. Вы можете купить сервера у одной из них или приобрести белый IP у вашего провайдера и установить сервер у себя дома. Во втором случае вы сами собираете свой собственный домашний сервер - любые отключения электропитания или интернета, технические проблемы на сервере, выход из строя каких то компонентов, стабильность - будут влиять на ваших игроков
- Отдавайте предпочтение хостинг провайдерам которым вы доверяете. Помните, что как у крупных хостинг провайдеров бывают плохо работающие сервера, так и у мелких провайдеров в силу своей непопулярности могут быть выгодные предложения
- Читайте отзывы. Чаше всего реальные отзывы оставляют люди у которых что то не работает или они недовольны хостингом - помните об этом когда будете их читать. Люди, у которых всё хорошо работает редко будут оставлять отзывы
- Купите минимальную конфигурацию или сервер с почасовой/подневной оплатой и проверьте скорость сетевого соеденения, пинг и потери пакетов, работу диска, удобство панели управления и другие параметры, важные для вас
- Прочитайте пользовательское соглашение
- Прочитайте FAQ и посты в блоге хостинг провайдера - там вы можете найти полезную информацию
- Посмотрите на дополнительные услуги и функции: есть ли защита от DDoS атак, выдают ли IPv6, можно ли загружать свои iso образы, есть ли объеденение нескольких виртуальных машин в одну сеть и т.д.

### Регистрация домена

Для того что бы использовать читаемые адреса вместо IP вам нужен домен. Часто компании, занимающиеся предоставлением хостинга, так же продают домены
- В разных зонах цена может сильно отличатся
- В некоторых зонах требуется предоставить дополнительные документы
- Смена регистратора и владельца в разных зонах и у разных регистраторов может отличаться
- Цена продления может сильно отличаться от изначальной цены - будьте внимательны

## Настройка локального окружения

Здесь и далее редполагается что вы купили VDS/Dedicated сервера необходимые вам и домен

- Вам необходимо установить [WSL](https://learn.microsoft.com/ru-ru/windows/wsl/install) если вы используете Windows на вашем ПК. Все дальнейшие команды во всех разделах приведены для Linux и WSL
- Выполните `ssh-keygen` что бы сгенерировать ключ SSH
- Выполните `ssh-copy-id root@IP` где IP - IP вашего VDS/Dedicated сервера. Если у вас несколько серверов выполните эту команду для каждого сервера. Пароль от root как правило пишется в панели управления хостингом

## Базовая настройка сервера

После того как вы настроили подключение к вашим серверам пора занятся их настройкой. В этом разделе мы настроим firewall, закроем вход в SSH по паролю и установим базовые инструменты. Если у вас несколько серверов - рекомендуется повторить эту процедуру для каждого
- Войдите на сервер командой `ssh root@IP`
- Установите базовые пакеты
:::: tabs
@tab Ubuntu/Debian
```bash
apt update
apt upgrade
apt install nftables nano vim htop iotop curl wget screen jq
```
@tab Fedora/CentOS
```bash
dnf upgrade
dnf install nftables nano vim htop iotop curl wget screen jq
```
@tab ArchLinux
```bash
pacman -Syu
pacman -S nftables nano vim htop iotop curl wget screen jq
```
::::
- Отключите аудентифицкаию по паролю - для этого выполните `nano /etc/ssh/sshd_config`, раскомментируйте строку `PasswordAuthentication` и установите её значение на `no`  
Сохранить Ctrl+O  
Выйти Ctrl + X
- Перезапустите sshd командой `systemctl restart sshd`
- Перезагрузите сервер командой `systemctl reboot`

### Настройка firewall

- Выполните `nano /etc/nftables.conf` и замените предыдущую конфигурацию на:
```bash
#!/sbin/nft -f

flush ruleset

table inet filter {
	chain input {
		type filter hook input priority 0; policy drop;
		ct state invalid counter drop comment "early drop of invalid packets"
		ct state {established, related} counter accept comment "accept all connections related to connections made by us"
		iif lo accept comment "accept loopback"
		iif != lo ip daddr 127.0.0.1/8 counter drop comment "drop connections to loopback not coming from loopback"
		iif != lo ip6 daddr ::1/128 counter drop comment "drop connections to loopback not coming from loopback"
		ip protocol icmp counter accept comment "accept all ICMP types"
		meta l4proto ipv6-icmp counter accept comment "accept all ICMP types"
		tcp dport 22 counter accept comment "accept SSH"
        tcp dport { http, https } counter accept comment "accept http/https"
        tcp dport { 25565 } counter accept comment "accept minecraft"
		counter comment "count dropped packets"
	}

	chain forward {
		type filter hook forward priority 0; policy drop;
		counter comment "count dropped packets"
	}

	# If we're not counting packets, this chain can be omitted.
	chain output {
		type filter hook output priority 0; policy accept;
		counter comment "count accepted packets"
	}
}
```
- Включите firewall `systemctl enable nftables`
- Запустите firewall `systemctl restart nftables`

## Установка LaunchServer

LaunchServer - это главный сервис лаунчера предоставляющий все самые важные функции:
- Сборка лаунчера (команда `build`)
- Сборка клиентов (команда `installclient`)
- Соеденение с различными сервисами авторизации и CMS
- Выполнение запросов от лаунчера, проверка авторизации и токенов доступа

Существуют несколько способов установки LaunchServer на вашу машину

### Установка с помощью Docker

:::: tabs
@tab [ UBUNTU | DEBIAN | CentOS 8/7 | Fedora 41^ ]
```bash
curl -sSL https://get.docker.com/ | bash
```
@tab [ ArchLinux]
Вы можете просто установить docker из официального репозитория
```bash
pacman -S docker
```
Запустите docker командой `systemctl enable --now docker`
::::
- Поддерживаемые дистрибутивы и архитектуры: [Docker Install](https://docs.docker.com/engine/install/)

После установки Docker выполните скрипт:

```bash

```

## Защита лаунчера

GravitLauncher предоставляет несколько механизмов призванных повысить безопасность и защиту от читеров. Некоторые из этих способов снижают удобство отладки и разработки, поэтому включать их  стоит на production лаунчсервере

### Опции лаунчера

- Установите параметр `env` в конфигурации лаунчсервера в PROD
- Установите параметр `encryptRuntime` в конфигурации лаунчсервера в `true`
- Установите параметр `type` в разделе `protectHandler` в `advanced`
- Перезапустите лаунчсервер и выполните `build`

### Установка GravitGuard

GravitGuard это проект созданный для защиты от читов основанных на инъекции dll в процесс

- Скачайте пресобранный билд или соберите самостоятельно проект [GravitGuard](https://github.com/GravitLauncher/GravitGuard)
- Поместите папку `guard` в папку `launcher-pack` лаунчсервера
- Установите модуль `LauncherGuard`
- Перезапустите лаунчсервер и выполните `build`

### CertificatePinning

Эта технология призвана защитить от атаки MITM через подстановку в систему своего TLS/SSL сертификата. Что бы её использовать выполните слеюущие действия:

- Определитесь с тем какой TLS сертификат вы будете использовать постоянно, например Cloudflare, Lets Encrypt или свой самоподписанный
- Скачайте корневой сертификат: в Firefox это можно сделать нажав на замочек, после чего открыть информацию о соеденении -> View SCertificate -> выбрав в списке самый правый сертификат и нажав `PEM (cert)`. В Chrome: значек меню слева от адресной строки -> Connection is secure -> выбрать самый верхний сертификат -> Export
- Положите сертификат с расширением crt в папку `truststure` лаунчсервера
- Установите `certificatePinning` в true в конфигурации лаунчсервера
- Перезапустите лаунчсервер и выполните `build`

::: tip
Если по той или иной причине вы захотите сменить провайдера сертификата TLS/SSL вам будет необходимо добавить новый сертификат в `truststore` лаунчсервера и сделать build до перехода после чего дождаться пока большинство игроков обновят лаунчер. В противном случае лаунчер не будет доверять новому сертификату и игроки не смогут запустить лаунчер и войти в игру без ручного обновления
:::

## Распространенные проблемы и их решения

### Защитник SmartScreen ругается на лаунчер

Это нормальное поведение защитника SmartScreen на любые файлы с низким числом скачиваний. Вы можете решить проблему несколькими способами:

- Купить полноценный сертификат подписи кода или воспользоватся услугами тех кто подпишет файл за вас (дорого)
- Отправить файл на проверку в Microsoft через [эту форму](https://www.microsoft.com/en-us/wdsi/filesubmission/)
